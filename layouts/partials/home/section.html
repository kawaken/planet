<h2 id="{{ with .id }}{{ . }}{{ else }}{{ .name | lower }}{{ end }}">
  {{ .name | title }}{{ with .comment}}<small>{{ . }}</small>{{ end }}
</h2>
{{ if .url }}
  {{ with resources.GetRemote .url }}
    {{ with .Err }}
      {{ errorf "Failed to fetch remote resource: %s" . }}
    {{ else }}
      {{ $data := . | transform.Unmarshal }}
      {{ partial $.type $data }}
    {{ end }}
  {{ end }}
{{ else }}
  {{ if .data }}
    {{ partial .type .data }}
  {{ end }}
{{ end }}

{{ define "partials/links" }}
  <ul>
    {{ range $index, $page := . }}
      <li>
        {{ with .date }}{{ . }}&nbsp;{{ end }}
        <a href="{{ .href }}">{{ .title }}</a>
      </li>
    {{ end }}
  </ul>
{{ end }}

{{ define "partials/panel" }}
  {{ $markdown := .content | markdownify }}
  <article>
    {{ if not ( strings.Contains $markdown "<p>" ) }}
      <p>{{ $markdown }}</p>
    {{ else }}
      {{ $markdown }}
    {{ end }}
  </article>
{{ end }}

{{ define "partials/photos" }}
  {{ $sizes := site.Param "photoSizes" | default "100vw" }}
  {{ $paginate := site.Param "photoPaginate" | default 32 }}
  {{ $bu := .base_url }}
  <div class="gallery">
    {{ range $photo := first $paginate (sort .photos "meta.taken_at" "desc") }}
      {{ $targets := where $photo.sources ".is_square" "==" false }}
      {{ $len := (len $targets) }}
      <img
        loading="lazy"
        srcset="
          {{- range $i, $src := $targets -}}
            {{ $bu }}/{{ path.Join $photo.id $src.name }} {{ $src.width -}}w
            {{- if ne (add $i 1) $len }},{{ end }}
          {{ end -}}
        "
        sizes="{{ $sizes }}"
        alt="{{ $photo.meta.title }}"
      />
      <link
        rel="preload"
        as="image"
        imagesrcset="
    {{- range $i, $src := $targets -}}
          {{ $bu }}/{{ path.Join $photo.id $src.name }} {{ $src.width -}}w
          {{- if ne (add $i 1) $len }},{{ end }}
        {{ end -}}
  "
        imagesizes="{{ $sizes }}"
      />
    {{ end }}
  </div>
{{ end }}

{{ define "partials/imagekit" }}
  {{ $paginate := site.Param "photoPaginate" | default 32 }}
  {{ partial "imagekit-gallery.html" (dict "photos" (first $paginate .photos)) }}
{{ end }}

{{ define "partials/slides" }}
<div class="slides">
  {{ range .slides }}
  <div class="slide">
    <a href="{{.url}}" target="_blank" rel="noopener"><img src="{{.src}}" alt="{{.title}}">{{.title}}</a>
  </div>
  {{ end }}
</div>
{{ end }}